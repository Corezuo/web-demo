<!doctype html>
<html lang="en" ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
    <title>打印模块</title>
</head>
<body>
    <div class="container" ng-controller="myCtrl">
        <div class="row">
            <h2 class="text-center">结账单</h2>
            <div class="col-lg-6">
                <div class="component-box">
                    <div class="module" ng-repeat="module in modules">
                        <div class="title">
                            <h2>{{module.moduleName}} <small>{{module.moduleDescribe}}</small></h2>
                        </div>
                        <div class="section">
                            <div ng-class="{'component': true, 'switch-on': componentEnableStaus[component.id]}"
                                 data-componentId={{component.id}}
                                 data-moduleid={{module.moduleId}}
                                 ng-repeat="component in module.components"
                                 ng-click="doSwitchComponent(component.id, componentEnableStaus[component.id])">
                                <table>
                                    <tbody>
                                        <tr>
                                            <td>{{component.label}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6" ng-controller="previewCtrl">
                <div class="template-container">
                    <div class="template-module-list">
                        <div class="template-module" ng-repeat="templateModule in templateModules">
                            <div class="template-row" ng-repeat="templateRow in templateModule.rows">
                                <div class="template-component" style="{{templateComponent.valueStyle}}" ng-repeat="templateComponent in templateRow.components">
                                    {{templateComponent.value}}
                                </div>
                            </div>
                            <!--模板分割线-->
                            <hr class="the-divider"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="application/javascript" src="assets/angular.js"></script>
    <script type="application/javascript" src="assets/template-web.js"></script>
    <script type="application/javascript" src="js/utils.js"></script>
    <script type="application/javascript">
        var myApp = angular.module('myApp', []);
        /**
         * This controller is used to adjust the template component
         * @param $scope
         * @param $http
         */
        myApp.controller('myCtrl', ['$scope', '$http', function ($scope, $http) {
            // 加载全部系统组件
            var param = {
                url: "data/system-component.json",
                sCallback: function (res) {
                    var data = angular.copy(res.data.modules),
                        modules = [],
                        componentEnableStaus = {};
                    for (var i = 0; i < data.length; i++) {
                        var module = data[i];
                        for (var j = 0; j < module.components.length; j++) {
                            var component = module.components[j];
                            if (component.component) {
                                module.components[j] = component.component;
                            }
                            // 组件默认禁用
                            componentEnableStaus[module.components[j].id] = false;
                        }
                        modules.push(module);
                    }
                    $scope.modules = modules;
                    $scope.componentEnableStaus = componentEnableStaus;
                    $scope.systemComponent = res.data.modules;
                }
            };
            baseRequest($http, param);

            // 加载模板预览组件
            param = {
                url: "data/preview-component-custom.json",
                sCallback: function (res) {
                    var previewComponent = res.data;
                    renderTemplateView(angular.copy(previewComponent));
                    initComponentStatus(angular.copy(previewComponent));
                    $scope.previewComponent = res.data;
                }
            };
            baseRequest($http, param);

            /**
             * 渲染模板视图
             * @param previewComponent 预览组件
             */
            function renderTemplateView (previewComponent) {
                console.log("previewComponent: ", previewComponent);
                // Todo：按模板划分、按行划分、按列划分；控制预览组件的显隐
                $scope.templateModules = previewComponent;
            }

            /**
             * 初始化组件启用状态
             * @param previewComponent 预览组件
             */
            function initComponentStatus (previewComponent) {
                var componentEnableStaus = $scope.componentEnableStaus;
                for (var i = 0; i < previewComponent.length; i++) {
                    var module = previewComponent[i];
                    for (var j = 0; j < module.rows.length; j++) {
                        var row = module.rows[j];
                        for (var n = 0; n < row.components.length; n++) {
                            var component = row.components[n];
                            if (component.component) {
                                componentEnableStaus[component.component.systemComponentId] = true;
                            } else {
                                componentEnableStaus[component.systemComponentId] = true;
                            }
                        }
                    }
                }
                $scope.componentEnableStaus = componentEnableStaus;
            }

            /**
             * 切换组件启用状态
             * @param componentId 组件id
             * @param showStatus  true-启用， false-禁用
             */
            $scope.doSwitchComponent = function (componentId, showStatus) {
                var componentEnableStaus = $scope.componentEnableStaus;
                componentEnableStaus[componentId] = !showStatus;
                $scope.componentEnableStaus = componentEnableStaus;
            };
        }]);

        /**
         * This controller is used to adjust the template component style
         * @param $scope
         * @param $http
         */
        myApp.controller('previewCtrl', ['$scope', '$http', function ($scope, $http) {
            $scope.isFlag = true;
            $scope.getSystemComponent = function () {
                $scope.isFlag = false;
            }
        }]);
    </script>
</body>
</html>
















