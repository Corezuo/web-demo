<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>vuex</title>
</head>
<body>
    <h2>hello vuex</h2>
    <div id="app">
        <p>count {{count}}</p>
        <p>count2 {{count2}}</p>
        <button @click="increment">点击+</button>
        <button @click="decrement">点击-</button>
        <button @click="dispatch">分发+</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex"></script>    
    <script>
        const store = new Vuex.Store({
            state: {
                count: 0
            },
            getters: {
                doneTodos(state) {
                    // 且只有当它的依赖值发生了改变才会被重新计算
                    return state.count;
                }
            },
            // Mutation 必须是同步函数
            // 你可以向 store.commit 传入额外的参数，即 mutation 的 载荷（payload）
            mutations: {
                increment (state, payload) {
                    state.count++
                    console.log("payload: ", payload);
                },
                decrement: state => state.count--
            },

            // Action 类似于 mutation，不同在于：
            // - Action 提交的是 mutation，而不是直接变更状态。
            // - Action 可以包含任意异步操作。

            // Action 函数接受一个与 store 实例具有相同方法和属性的 context 对象，因此你可以调用 context.commit 提交一个 mutation，
            // 或者通过 context.state 和 context.getters 来获取 state 和 getters。
            actions: {
                increment (context, payload) {
                    console.log("payload: ", payload);
                    context.commit('increment')
                }
            }
        })

        new Vue({
            el: '#app',
            computed: {
                count () {
                    return store.state.count
                },
                count2 () {
                    return store.getters.doneTodos
                }
            },
            methods: {
                increment () {
                    // 更改 Vuex 的 store 中的状态的唯一方法是提交 mutation。Vuex 中的 mutation 非常类似于事件：
                    // 每个 mutation 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们实际进行状态更改的地方，
                    // 并且它会接受 state 作为第一个参数：

                    store.commit('increment', {
                        amount: 10
                    })

                    // 方式二
                    // store.commit({
                    //     type: 'increment',
                    //     amount: 10
                    // })
                },
                decrement () {
                    store.commit('decrement')
                },
                dispatch () {
                    store.dispatch('increment', {
                        amount: 10
                    })
                }
            }
        })

        // 参考购物车示例：https://github.com/vuejs/vuex/tree/dev/examples/shopping-cart
    </script>
</body>
</html>